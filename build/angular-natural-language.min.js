/*! angular-natural-language 2013-08-21 */
angular.module("vr.directives.nlForm",["vr.directives.nlForm.select","vr.directives.nlForm.text"]),angular.module("vr.directives.nlForm.select",[]).directive("nlSelect",function(){return{restrict:"EA",replace:!0,scope:{value:"=",options:"="},controller:"nlSelectCtrl",template:"<div ng-form='nlSelect' class='nl-field nl-dd' ng-class=\"{'nl-field-open': opened}\"><a class='nl-field-toggle' ng-click='open($event)' ng-bind='getSelected()'></a><ul><li ng-repeat='label in getLabels()' ng-class=\"{'nl-dd-checked': isSelected(label)}\" ng-click='select(label)' ng-bind='label'></li></ul></div>",link:function(a,b,c){a.required=!angular.isUndefined(c.required),a.multiple=!angular.isUndefined(c.multiple),a.conjunction=a.multiple&&""!=c.multiple?c.multiple:"and",a.none=angular.isUndefined(c.empty)?"none":c.empty,a.multiple&&!angular.isArray(a.value)&&(a.value=[a.value]);var d=!1;angular.forEach(b.parent().children(),function(a){a=angular.element(a),a.hasClass("nl-overlay")&&(d=a)}),d||(d=angular.element('<div class="nl-overlay"></div>'),b.parent().append(d)),d.bind("click",function(){a.$apply(a.close)})}}}).controller("nlSelectCtrl",["$scope",function(a){function b(b){var c=!1;return angular.forEach(a.options,function(d){switch(a.optionType){case h:case j:b==d&&(c=!0);break;case i:case k:b==d.value&&(c=!0)}}),c}function c(){switch(a.optionType){case h:case i:return a.options.length;case k:case j:var b=0;return angular.forEach(a.options,function(){b++}),b}return 0}function d(b){if(b<c()&&b>=0)switch(a.optionType){case h:return{value:a.options[0],label:a.options[0]};case i:return a.options[0];case j:case k:var d=null,e=0;return angular.forEach(a.options,function(c,f){e==b&&(d=a.optionType==j?{value:c,label:f}:c),e++}),d}return{value:"",label:""}}function e(b){var c=b;switch(a.optionType){case i:case k:angular.forEach(a.options,function(a){a.value==b&&(c=a.label)});break;case h:break;case j:angular.forEach(a.options,function(a,d){b==a&&(c=d)})}return c}function f(b){var c=b;switch(a.optionType){case h:break;case i:angular.forEach(a.options,function(a){a.label==b&&(c=a.value)});break;case j:c=a.options[b];break;case k:c=a.options[b].value}return c}function g(){if(a.multiple){var c=[];angular.forEach(a.value,function(a){b(a)&&c.push(a)}),a.value=c}else b(a.value)||(a.value=d(0).value)}var h=1,i=2,j=3,k=4;a.opened=!1,a.open=function(b){b.stopPropagation(),a.opened=!0},a.close=function(){a.opened=!1},a.select=function(b){a.setValue(b),a.close()},a.setValue=function(b){var c=f(b);if(a.multiple){var d=a.value.indexOf(c);-1==d?a.value.push(c):a.value.splice(d,1),a.required&&(0==a.value.length?a.nlSelect.$setValidity("required",!1):a.nlSelect.$setValidity("required",!0))}else a.value=c},a.getLabels=function(){switch(a.optionType){case h:return a.options;case i:return a.options.map(function(a){return a.label});case j:case k:var b=[];return angular.forEach(a.options,function(c,d){a.optionType==j?b.push(d):b.push(c.label)}),b}return[]},a.getSelected=function(){if(a.multiple){var b="";if(a.value.length>0){var c="",d=1;angular.forEach(a.value,function(f){b+=c+e(f),d++,c=a.value.length>2?", ":" ",d==a.value.length&&(c+=a.conjunction+" ")})}else b=a.none;return b}return e(a.value)},a.isSelected=function(b){return a.multiple?a.value.indexOf(f(b))>-1:a.value==f(b)},a.$watch("options",function(){if(a.optionType=null,angular.isArray(a.options))a.optionType=angular.isObject(a.options[0])?i:h;else if(angular.isObject(a.options))for(var b in a.options)if(a.options.hasOwnProperty(b)){a.optionType=angular.isObject(a.options[b])?k:j;break}g()},!0)}]),angular.module("vr.directives.nlForm.text",[]).directive("nlText",function(){return{restrict:"EA",replace:!0,scope:{placeholder:"@",subline:"@",name:"@",value:"="},template:'<div ng-form class="nl-field nl-ti-text" ng-class="{\'nl-field-open\': opened}"><a class="nl-field-toggle" ng-click="open($event)" ng-bind="viewValue()"></a><ul><li class="nl-ti-input"><input type="text" placeholder="{{ placeholder }}" name="{{ name }}" ng-model="value" ng-click="$event.stopPropagation()" ng-required="required"/><button class="nl-field-go" ng-click="close()">Go</button></li><li class="nl-ti-example" ng-show="showSubline()" ng-bind-html-unsafe="subline"></li></ul></div>',controller:"nlTextCtrl",link:function(a,b,c){a.required=!angular.isUndefined(c.required);var d=!1;angular.forEach(b.parent().children(),function(a){a=angular.element(a),a.hasClass("nl-overlay")&&(d=a)}),d||(d=angular.element('<div class="nl-overlay"></div>'),b.parent().append(d)),d.bind("click",function(){a.$apply(a.close)})}}}).controller("nlTextCtrl",["$scope",function(a){a.opened=!1,a.open=function(b){b.stopPropagation(),a.opened=!0},a.close=function(){a.opened=!1},a.viewValue=function(){return""==a.value?a.placeholder:a.value},a.showSubline=function(){return angular.isString(a.subline)&&""!=a.subline}}]);